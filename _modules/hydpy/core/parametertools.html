
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>hydpy.core.parametertools &#8212; HydPy 2.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.core.parametertools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module implements tools for handling the parameters of</span>
<span class="sd">hydrological models.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...standard</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="c1"># ...third party</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="c1"># ...HydPy specific</span>
<span class="kn">from</span> <span class="nn">hydpy</span> <span class="k">import</span> <span class="n">pub</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">objecttools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">filetools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">timetools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">autodoctools</span>


<span class="c1"># The import of `_strptime` is not thread save.  The following call of</span>
<span class="c1"># `strptime` is supposed to prevent possible problems arising from this bug.</span>
<span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;1999&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Parameters"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameters">[docs]</a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling all parameters of a specific model.&quot;&quot;&quot;</span>

    <span class="n">_names_subpars</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="s1">&#39;derived&#39;</span><span class="p">,</span> <span class="s1">&#39;solver&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cythonmodule</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cythonmodule&#39;</span><span class="p">)</span>
        <span class="n">cymodel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cymodel&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">SubParameters</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cythonmodule</span><span class="p">:</span>
                    <span class="n">cls_fastaccess</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cythonmodule</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="n">subpars</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls_fastaccess</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">subpars</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subpars</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">subpars</span><span class="p">)</span>

<div class="viewcode-block" id="Parameters.update"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameters.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call the update methods of all derived and solver parameters.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subpars</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_subpars</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">subpars</span><span class="o">.</span><span class="n">_PARCLASSES</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">instancename</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">subpars</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                    <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                        <span class="s1">&#39;While trying to update the </span><span class="si">%s</span><span class="s1"> parameter `</span><span class="si">%s</span><span class="s1">` of &#39;</span>
                        <span class="s1">&#39;element `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">subpars</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Parameters.savecontrols"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameters.savecontrols">[docs]</a>    <span class="k">def</span> <span class="nf">savecontrols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameterstep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">simulationstep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dirname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controldefaultfilename</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;.py&#39;</span>
            <span class="k">if</span> <span class="n">dirname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dirname</span> <span class="o">=</span> <span class="n">pub</span><span class="o">.</span><span class="n">controlmanager</span><span class="o">.</span><span class="n">controlpath</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
                <span class="n">file_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;from hydpy.models.</span><span class="si">%s</span><span class="s1"> import *</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                            <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parameterstep</span><span class="p">:</span>
                    <span class="n">parameterstep</span> <span class="o">=</span> <span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">stepsize</span>
                <span class="n">file_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;parameterstep(&quot;</span><span class="si">%s</span><span class="s1">&quot;)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">parameterstep</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">simulationstep</span><span class="p">:</span>
                    <span class="n">simulationstep</span> <span class="o">=</span> <span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">stepsize</span>
                <span class="n">file_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;simulationstep(&quot;</span><span class="si">%s</span><span class="s1">&quot;)</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">simulationstep</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">:</span>
                    <span class="n">_parameterstep</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">_parameterstep</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">par</span><span class="o">.</span><span class="n">parameterstep</span> <span class="o">=</span> <span class="n">parameterstep</span>
                        <span class="n">file_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">par</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">par</span><span class="o">.</span><span class="n">_parameterstep</span> <span class="o">=</span> <span class="n">_parameterstep</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_controldefaultfilename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s1">&#39;To save the control parameters of a model to a file, its &#39;</span>
                <span class="s1">&#39;filename must be known.  This can be done, by passing &#39;</span>
                <span class="s1">&#39;filename to function `savecontrols` directly.  &#39;</span>
                <span class="s1">&#39;But in complete HydPy applications, it is usally &#39;</span>
                <span class="s1">&#39;assumed to be consistent with the name of the element &#39;</span>
                <span class="s1">&#39;handling the model.  Actually, neither a filename is given &#39;</span>
                <span class="s1">&#39;nor does the model know its master element.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span>

<div class="viewcode-block" id="Parameters.verify"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameters.verify">[docs]</a>    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">:</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived</span><span class="p">:</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">secondary_subpars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">subpars</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subpars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">subpars</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names_subpars</span><span class="p">:</span>
            <span class="n">subpars</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subpars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">subpars</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="MetaSubParametersType"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.MetaSubParametersType">[docs]</a><span class="k">class</span> <span class="nc">MetaSubParametersType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parents</span><span class="p">,</span> <span class="n">dict_</span><span class="p">):</span>
        <span class="n">parclasses</span> <span class="o">=</span> <span class="n">dict_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_PARCLASSES&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parclasses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;For class `</span><span class="si">%s</span><span class="s1">`, the required tuple `_PARCLASSES` is not &#39;</span>
                <span class="s1">&#39;defined.  Please see the documentation of class &#39;</span>
                <span class="s1">&#39;`SubParameters` of module `parametertools` for further &#39;</span>
                <span class="s1">&#39;information.&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parclasses</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n\n\n</span><span class="s1">    The following parameter classes are selected:&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">parclass</span> <span class="ow">in</span> <span class="n">parclasses</span><span class="p">:</span>
                    <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;      * :class:`~</span><span class="si">%s</span><span class="s1">` `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">parclass</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
                                            <span class="n">parclass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)),</span>
                                  <span class="n">autodoctools</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="n">parclass</span><span class="p">)))</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">dict_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">dict_</span><span class="p">[</span><span class="s1">&#39;__doc__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">doc</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parents</span><span class="p">,</span> <span class="n">dict_</span><span class="p">)</span></div>


<span class="n">MetaSubParametersClass</span> <span class="o">=</span> <span class="n">MetaSubParametersType</span><span class="p">(</span><span class="s1">&#39;MetaSubParametersClass&#39;</span><span class="p">,</span>
                                               <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;_PARCLASSES&#39;</span><span class="p">:</span> <span class="p">()})</span>


<div class="viewcode-block" id="SubParameters"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SubParameters">[docs]</a><span class="k">class</span> <span class="nc">SubParameters</span><span class="p">(</span><span class="n">MetaSubParametersClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling subgroups of model parameters.</span>

<span class="sd">    When trying to implement a new model, one has to define its parameter</span>
<span class="sd">    classes.  Currently, the HydPy framework  distinguishes between control</span>
<span class="sd">    parameters and derived parameters.  These parameter classes should be</span>
<span class="sd">    collected by subclasses of class :class:`SubParameters` called</span>
<span class="sd">    `ControlParameters` or `DerivedParameters` respectivly.  This should be</span>
<span class="sd">    done via the `_PARCLASSES` tuple in the following manner:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import SingleParameter, SubParameters</span>
<span class="sd">    &gt;&gt;&gt; class Par2(SingleParameter):</span>
<span class="sd">    ...     pass</span>
<span class="sd">    &gt;&gt;&gt; class Par1(SingleParameter):</span>
<span class="sd">    ...     pass</span>
<span class="sd">    &gt;&gt;&gt; class ControlParameters(SubParameters):</span>
<span class="sd">    ...     _PARCLASSES = (Par2, Par1)</span>

<span class="sd">    The order within the tuple determines the order of iteration, e.g.:</span>

<span class="sd">    &gt;&gt;&gt; control = ControlParameters(None) # Assign `None` for brevity.</span>
<span class="sd">    &gt;&gt;&gt; control</span>
<span class="sd">    par2(nan)</span>
<span class="sd">    par1(nan)</span>

<span class="sd">    If one forgets to define a `_PARCLASSES` tuple so (and maybe tries to add</span>
<span class="sd">    the parameters in the constructor of the subclass of</span>
<span class="sd">    :class:`SubParameters`, the following error is raised:</span>

<span class="sd">    &gt;&gt;&gt; class ControlParameters(SubParameters):</span>
<span class="sd">    ...     pass</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    NotImplementedError: For class `ControlParameters`, the required tuple `_PARCLASSES` is not defined.  Please see the documentation of class `SubParameters` of module `parametertools` for further information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_PARCLASSES</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">cls_fastaccess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cymodel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pars</span> <span class="o">=</span> <span class="n">pars</span>
        <span class="k">if</span> <span class="n">cls_fastaccess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">FastAccess</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="n">cls_fastaccess</span><span class="p">()</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cymodel</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">Par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PARCLASSES</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">instancename</span><span class="p">(</span><span class="n">Par</span><span class="p">),</span> <span class="n">Par</span><span class="p">())</span>

<div class="viewcode-block" id="SubParameters.getname"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SubParameters.getname">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getname</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">instancename</span><span class="p">(</span><span class="bp">cls</span><span class="p">)[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getname</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Attributes and methods should usually not be replaced.  Existing</span>
<span class="sd">        :class:`Parameter` attributes are protected in a way, that only their</span>
<span class="sd">        values are changed through assignements.  For new :class:`Parameter`</span>
<span class="sd">        attributes, additional `fastaccess` references are defined.  If you</span>
<span class="sd">        actually want to replace a parameter, you have to delete it first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;connect&#39;</span><span class="p">):</span>
                <span class="n">value</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">_setvalue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">` instances do not allow the direct&#39;</span>
                                   <span class="s1">&#39;replacement of their members.  After &#39;</span>
                                   <span class="s1">&#39;initialization you should usually only &#39;</span>
                                   <span class="s1">&#39;change parameter values through &#39;</span>
                                   <span class="s1">&#39;assignements.  If you really need to &#39;</span>
                                   <span class="s1">&#39;replace a object member, delete it &#39;</span>
                                   <span class="s1">&#39;beforehand.&#39;</span> <span class="o">%</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">classname</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">Par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PARCLASSES</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">instancename</span><span class="p">(</span><span class="n">Par</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">reprcomments</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">%s</span><span class="s1"> object defined in module </span><span class="si">%s</span><span class="s1">.&#39;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="n">objecttools</span><span class="o">.</span><span class="n">classname</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                            <span class="n">objecttools</span><span class="o">.</span><span class="n">modulename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# The implemented parameters with their actual &#39;</span>
                         <span class="s1">&#39;values are:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">parameter</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(?)&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Parameter"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter">[docs]</a><span class="k">class</span> <span class="nc">Parameter</span><span class="p">(</span><span class="n">objecttools</span><span class="o">.</span><span class="n">ValueMath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for :class:`SingleParameter` and :class:`MultiParameter`.&quot;&quot;&quot;</span>

    <span class="n">_parameterstep</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_simulationstep</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subpars</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">FastAccess</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The prefered way to pass values to :class:`Parameter` instances</span>
<span class="sd">        within parameter control files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;For parameter </span><span class="si">%s</span><span class="s1"> of element </span><span class="si">%s</span><span class="s1"> both positional &#39;</span>
                             <span class="s1">&#39;and keyword arguments are given, which is &#39;</span>
                             <span class="s1">&#39;ambiguous.&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;For parameter </span><span class="si">%s</span><span class="s1"> of element </span><span class="si">%s</span><span class="s1"> neither a &#39;</span>
                             <span class="s1">&#39;positional nor a keyword argument is given.&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="s1">&#39;pyfile&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getvalues_from_auxiliaryfile</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pyfile&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applytimefactor</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="k">del</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pyfile&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applytimefactor</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;The value(s) of parameter </span><span class="si">%s</span><span class="s1"> of &#39;</span>
                                      <span class="s1">&#39;element </span><span class="si">%s</span><span class="s1"> could not be set based on &#39;</span>
                                      <span class="s1">&#39;the given keyword arguments.&#39;</span>
                                      <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                         <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_getvalues_from_auxiliaryfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pyfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tries to return the parameter values from the auxiliary control file</span>
<span class="sd">        with the given name.</span>

<span class="sd">        Things are a little complicated here.  To understand this method, you</span>
<span class="sd">        should first take a look at function :func:`parameterstep`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_back</span>
        <span class="k">while</span> <span class="n">frame</span><span class="p">:</span>
            <span class="n">namespace</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">subnamespace</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">namespace</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span>
                                <span class="s1">&#39;focus&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_back</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Something has gone wrong when trying to &#39;</span>
                               <span class="s1">&#39;read parameter `</span><span class="si">%s</span><span class="s1">` from file `</span><span class="si">%s</span><span class="s1">`.&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pyfile</span><span class="p">))</span>
        <span class="n">filetools</span><span class="o">.</span><span class="n">ControlManager</span><span class="o">.</span><span class="n">read2dict</span><span class="p">(</span><span class="n">pyfile</span><span class="p">,</span> <span class="n">subnamespace</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subself</span> <span class="o">=</span> <span class="n">subnamespace</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Something has gone wrong when trying to &#39;</span>
                               <span class="s1">&#39;read parameter `</span><span class="si">%s</span><span class="s1">` from file `</span><span class="si">%s</span><span class="s1">`.&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pyfile</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">subself</span><span class="o">.</span><span class="n">values</span>

    <span class="n">name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">objecttools</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">initvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">initvalue</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;INIT&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span>
                     <span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">usedefaultvalues</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">initvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">type_</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">initvalue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">elif</span> <span class="n">type_</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">initvalue</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">_INT_NAN</span>
            <span class="k">elif</span> <span class="n">type_</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="n">initvalue</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s1">&#39;For parameter `</span><span class="si">%s</span><span class="s1">` no `INIT` class attribute is &#39;</span>
                    <span class="s1">&#39;defined, but no standard value for its TYPE `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                    <span class="s1">&#39;is available&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">classname</span><span class="p">(</span><span class="n">type_</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">initvalue</span>

    <span class="k">def</span> <span class="nf">_getparameterstep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The parameter time step size new parameter values might be related</span>
<span class="sd">        to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_parameterstep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The general parameter time step has not been &#39;</span>
                               <span class="s1">&#39;defined so far.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameterstep</span>

    <span class="k">def</span> <span class="nf">_setparameterstep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="o">.</span><span class="n">_parameterstep</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span><span class="s1">&#39;While trying to set the general &#39;</span>
                                          <span class="s1">&#39;parameter time step&#39;</span><span class="p">)</span>

    <span class="n">parameterstep</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getparameterstep</span><span class="p">,</span> <span class="n">_setparameterstep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getsimulationstep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The simulation time step size new parameter values might be related</span>
<span class="sd">        to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">stepsize</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">_simulationstep</span>

    <span class="k">def</span> <span class="nf">_setsimulationstep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="o">.</span><span class="n">_simulationstep</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span><span class="s1">&#39;While trying to set the general &#39;</span>
                                          <span class="s1">&#39;simulation time step&#39;</span><span class="p">)</span>

    <span class="n">simulationstep</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getsimulationstep</span><span class="p">,</span> <span class="n">_setsimulationstep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_gettimefactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Factor to adapt a new parameter value related to</span>
<span class="sd">        :attr:`parameterstep` to a different simulation time step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parfactor</span> <span class="o">=</span> <span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">parfactor</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulationstep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The calculation of the effective value &#39;</span>
                                   <span class="s1">&#39;of parameter `</span><span class="si">%s</span><span class="s1">` requires a definition &#39;</span>
                                   <span class="s1">&#39;of the actual simulation time step.  &#39;</span>
                                   <span class="s1">&#39;The simulation time step is project &#39;</span>
                                   <span class="s1">&#39;specific.  When initializing the HydPy &#39;</span>
                                   <span class="s1">&#39;framework, it is automatically specified &#39;</span>
                                   <span class="s1">&#39;under `pub.timegrids.stepsize.  For &#39;</span>
                                   <span class="s1">&#39;testing purposes, one can alternatively &#39;</span>
                                   <span class="s1">&#39;apply the function `simulationstep`.  &#39;</span>
                                   <span class="s1">&#39;Please see the documentation for more &#39;</span>
                                   <span class="s1">&#39;details.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">date1</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="s1">&#39;2000.01.01&#39;</span><span class="p">)</span>
                <span class="n">date2</span> <span class="o">=</span> <span class="n">date1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulationstep</span>
                <span class="n">parfactor</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Timegrids</span><span class="p">(</span><span class="n">timetools</span><span class="o">.</span><span class="n">Timegrid</span><span class="p">(</span>
                                 <span class="n">date1</span><span class="p">,</span> <span class="n">date2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulationstep</span><span class="p">))</span><span class="o">.</span><span class="n">parfactor</span>
        <span class="k">return</span> <span class="n">parfactor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameterstep</span><span class="p">)</span>

    <span class="n">timefactor</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_gettimefactor</span><span class="p">)</span>

    <span class="n">trim</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">trim</span>

<div class="viewcode-block" id="Parameter.warntrim"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.warntrim">[docs]</a>    <span class="k">def</span> <span class="nf">warntrim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;For parameter </span><span class="si">%s</span><span class="s1"> of element </span><span class="si">%s</span><span class="s1"> at least one value &#39;</span>
                      <span class="s1">&#39;needed to be trimmed.  Two possible reasons could be &#39;</span>
                      <span class="s1">&#39;that the a parameter bound violated or that the values &#39;</span>
                      <span class="s1">&#39;of two (or more) different parameters are inconsistent.&#39;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Parameter.applytimefactor"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.applytimefactor">[docs]</a>    <span class="k">def</span> <span class="nf">applytimefactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the given parameter value/values in accordance with the</span>
<span class="sd">        actual parameter simulation time step if necessary, and return it/them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: At least `values /= self.timefactor` is less flexible than</span>
        <span class="c1"># `values = values / self.timefactor` regarding the type of `values`.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIME</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timefactor</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIME</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">timefactor</span>
        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="Parameter.reverttimefactor"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.reverttimefactor">[docs]</a>    <span class="k">def</span> <span class="nf">reverttimefactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the given parameter value/values inversely in accordance</span>
<span class="sd">        with the actual parameter simulation time step if necessary, and</span>
<span class="sd">        return it/them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: At least `values /= self.timefactor` is less flexible than</span>
        <span class="c1"># `values = values / self.timefactor` regarding the type of `values`.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIME</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">timefactor</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIME</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timefactor</span>
        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="Parameter.commentrepr"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.Parameter.commentrepr">[docs]</a>    <span class="k">def</span> <span class="nf">commentrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list with comments, e.g. for making string representations</span>
<span class="sd">        more informative.  When :attr:`pub.options.reprcomments` is set to</span>
<span class="sd">        `False`, an empty list is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Parameter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">commentrepr</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">reprcomments</span> <span class="ow">and</span>
                <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;TIME&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# The actual value representation depends on &#39;</span>
                         <span class="s1">&#39;the actual parameter step size,&#39;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;# which is `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterstep</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="SingleParameter"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SingleParameter">[docs]</a><span class="k">class</span> <span class="nc">SingleParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for model parameters handling a single value.&quot;&quot;&quot;</span>
    <span class="n">NDIM</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">SPAN</span><span class="p">,</span> <span class="n">INIT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="kc">None</span>

<div class="viewcode-block" id="SingleParameter.connect"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SingleParameter.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subpars</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subpars</span> <span class="o">=</span> <span class="n">subpars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="n">subpars</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initvalue</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_getshape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An empty tuple.  (Only intended for increasing consistent usability</span>
<span class="sd">        of :class:`SingleParameter` and :class:`MultiParameter` instances.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">_setshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The shape information of `SingleParameters` &#39;</span>
                           <span class="s1">&#39;as `</span><span class="si">%s</span><span class="s1">` cannot be changed.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getshape</span><span class="p">,</span> <span class="n">_setshape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual parameter value handled by the respective</span>
<span class="sd">        :class:`SingleParameter` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> values are assigned to the scalar &#39;</span>
                                 <span class="s1">&#39;parameter `</span><span class="si">%s</span><span class="s1">`, which is ambiguous.&#39;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;When trying to set the value of parameter `</span><span class="si">%s</span><span class="s1">`, &#39;</span>
                            <span class="s1">&#39;it was not possible to convert `</span><span class="si">%s</span><span class="s1">` to type &#39;</span>
                            <span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                                       <span class="n">objecttools</span><span class="o">.</span><span class="n">classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">)))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getvalue</span><span class="p">,</span> <span class="n">_setvalue</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="SingleParameter.verify"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SingleParameter.verify">[docs]</a>    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raises a :class:`~exceptions.RuntimeError` if the value of the</span>
<span class="sd">        instance of the respective subclass of :class:`SingleParameter` is</span>
<span class="sd">        `nan`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The value of parameter `</span><span class="si">%s</span><span class="s1">` has not been &#39;</span>
                               <span class="s1">&#39;set yet.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns 1.  (This method is only intended for increasing consistent</span>
<span class="sd">        usability of :class:`SingleParameter` and :class:`MultiParameter`</span>
<span class="sd">        instances.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;The only allowed index for scalar parameters &#39;</span>
                             <span class="s1">&#39;like `</span><span class="si">%s</span><span class="s1">` is `0` (or `:`), but `</span><span class="si">%s</span><span class="s1">` is given.&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;The only allowed index for scalar parameters &#39;</span>
                             <span class="s1">&#39;like `</span><span class="si">%s</span><span class="s1">` is `0` (or `:`), but `</span><span class="si">%s</span><span class="s1">` is given.&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commentrepr</span><span class="p">()</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span>
                     <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverttimefactor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>


<div class="viewcode-block" id="MultiParameter"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.MultiParameter">[docs]</a><span class="k">class</span> <span class="nc">MultiParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for model parameters handling multiple values.&quot;&quot;&quot;</span>
    <span class="n">NDIM</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">SPAN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="MultiParameter.connect"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.MultiParameter.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subpars</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subpars</span> <span class="o">=</span> <span class="n">subpars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="n">subpars</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_getshape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A tuple containing the lengths in all dimensions of the parameter</span>
<span class="sd">        values.  Note that setting a new shape results in a loss of all values</span>
<span class="sd">        of the respective parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Shape information for parameter `</span><span class="si">%s</span><span class="s1">` &#39;</span>
                               <span class="s1">&#39;can only be retrieved after it has been &#39;</span>
                               <span class="s1">&#39;defined.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initvalue</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span><span class="s1">&#39;While trying create a new numpy &#39;</span>
                                          <span class="s1">&#39;ndarray` for parameter `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                                          <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parameter `</span><span class="si">%s</span><span class="s1">` is </span><span class="si">%d</span><span class="s1">-dimensional but the &#39;</span>
                             <span class="s1">&#39;given shape indicates </span><span class="si">%d</span><span class="s1"> dimensions.&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getshape</span><span class="p">,</span> <span class="n">_setshape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual parameter value(s) handled by the respective</span>
<span class="sd">        :class:`Parameter` instance.  For consistency, `value` and `values`</span>
<span class="sd">        can always be used interchangeably.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The values `</span><span class="si">%s</span><span class="s1">` cannot be converted to a numpy &#39;</span>
                             <span class="s1">&#39;ndarray with shape </span><span class="si">%s</span><span class="s1"> containing entries of &#39;</span>
                             <span class="s1">&#39;type </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                           <span class="n">objecttools</span><span class="o">.</span><span class="n">classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">)))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getvalue</span><span class="p">,</span> <span class="n">_setvalue</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_getverifymask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A numpy array with all entries being `True` of the same</span>
<span class="sd">        shape as the values handled by the respective parameter.  All entries</span>
<span class="sd">        beeing `True` indicates that the method :func:`~MultiParameter.verify`</span>
<span class="sd">        checks all entries of the numpy array storing the parameter values.</span>
<span class="sd">        Overwrite :func:`~MultiParameter.verify` for :class:`MultiParameter`</span>
<span class="sd">        subclasses, where certain entries do not to be checked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">verifymask</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getverifymask</span><span class="p">)</span>

<div class="viewcode-block" id="MultiParameter.verify"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.MultiParameter.verify">[docs]</a>    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raises a :class:`~exceptions.RuntimeError` if at least one of the</span>
<span class="sd">        required values of the instance of the respective subclass of</span>
<span class="sd">        :class:`MultiParameter` is `None` or `nan`. The property</span>
<span class="sd">        :func:`~MultiParameter.verifymask` defines, which values are</span>
<span class="sd">        considered to be necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The values of parameter `</span><span class="si">%s</span><span class="s1">` have not &#39;</span>
                               <span class="s1">&#39;been set yet.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">nmbnan</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">verifymask</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">nmbnan</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;For parameter `</span><span class="si">%s</span><span class="s1">`, </span><span class="si">%d</span><span class="s1"> required values have &#39;</span>
                               <span class="s1">&#39;not been set yet.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">nmbnan</span><span class="p">))</span></div>

<div class="viewcode-block" id="MultiParameter.copy"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.MultiParameter.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a deep copy of the parameter values.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of values handled by the :class:`MultiParameter`</span>
<span class="sd">        instance.  It is required, that the `shape` has been set beforehand,</span>
<span class="sd">        which specifies the length in each dimension.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raiseitemexception</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raiseitemexception</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_raiseitemexception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Parameter `</span><span class="si">%s</span><span class="s1">` has no values so far.&#39;</span>
                               <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span><span class="s1">&#39;While trying to item access the &#39;</span>
                                          <span class="s1">&#39;values of parameter `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                                          <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="MultiParameter.compressrepr"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.MultiParameter.compressrepr">[docs]</a>    <span class="k">def</span> <span class="nf">compressrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a compressed parameter value string, which is (in</span>
<span class="sd">        accordance with :attr:`~MultiParameter.NDIM`) contained in a</span>
<span class="sd">        nested list.  If the compression fails, a</span>
<span class="sd">        :class:`~exceptions.NotImplementedError` is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">unique</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverttimefactor</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">unique</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;For parameter `</span><span class="si">%s</span><span class="s1">` there is no &#39;</span>
                                      <span class="s1">&#39;compression method implemented, &#39;</span>
                                      <span class="s1">&#39;working for its actual values.&#39;</span>
                                      <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressrepr</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="n">islong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">255</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverttimefactor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span><span class="s1">&#39;While trying to find a compressed &#39;</span>
                                          <span class="s1">&#39;string representation for &#39;</span>
                                          <span class="s1">&#39;parameter `</span><span class="si">%s</span><span class="s1">`&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">islong</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Parameter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_repr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">islong</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZipParameter"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.ZipParameter">[docs]</a><span class="k">class</span> <span class="nc">ZipParameter</span><span class="p">(</span><span class="n">MultiParameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for model parameters handling multiple values that offers</span>
<span class="sd">    additional keyword zipping fuctionality.</span>

<span class="sd">    When inheriting an actual parameter class from :class:`ZipParameter` one</span>
<span class="sd">    needs to define suitable class constants</span>
<span class="sd">    :const:`~ZipParameter.REQUIRED_VALUES` (a :class:`tuple`) and</span>
<span class="sd">    :const:`~ZipParameter.MODEL_CONSTANTS` (a :class:`dict`).  Additionally,</span>
<span class="sd">    a property named `refparameter` must be defined.</span>

<span class="sd">    The implementation and functioning of subclasses of :class:`ZipParameter`</span>
<span class="sd">    is best illustrated by an example: see the documentation of the class</span>
<span class="sd">    :class:`~hydpy.models.hland.hland_parameters.MultiParameter` of the</span>
<span class="sd">    HydPy-H-Land model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">REQUIRED_VALUES</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">MODEL_CONSTANTS</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The prefered way to pass values to :class:`Parameter` instances</span>
<span class="sd">        within parameter control files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">refvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refparameter</span><span class="o">.</span><span class="n">values</span>
                <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">refvalues</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Parameter </span><span class="si">%s</span><span class="s1"> does not seem to &#39;</span>
                                       <span class="s1">&#39;be prepared properly for element </span><span class="si">%s</span><span class="s1">.  &#39;</span>
                                       <span class="s1">&#39;Hence, setting values for parameter &#39;</span>
                                       <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> via keyword arguments is not &#39;</span>
                                       <span class="s1">&#39;possible.&#39;</span>
                                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refparameter</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                          <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODEL_CONSTANTS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">sel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">exc</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">refvalues</span> <span class="o">==</span> <span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applytimefactor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exc</span>

    <span class="k">def</span> <span class="nf">_getshape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a tuple containing the lengths in all dimensions of the</span>
<span class="sd">        parameter values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultiParameter</span><span class="o">.</span><span class="n">_getshape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Shape information for parameter `</span><span class="si">%s</span><span class="s1">` can &#39;</span>
                               <span class="s1">&#39;only be retrieved after it has been defined. &#39;</span>
                               <span class="s1">&#39; You can do this manually, but usually it is &#39;</span>
                               <span class="s1">&#39;done automatically by defining the value of &#39;</span>
                               <span class="s1">&#39;parameter `</span><span class="si">%s</span><span class="s1">` first in each parameter &#39;</span>
                               <span class="s1">&#39;control file.&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeparameter</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getshape</span><span class="p">,</span> <span class="n">MultiParameter</span><span class="o">.</span><span class="n">_setshape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getverifymask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A numpy array of the same shape as the value array handled</span>
<span class="sd">        by the respective parameter.  `True` entries indicate that certain</span>
<span class="sd">        parameter values are required, which depends on the tuple</span>
<span class="sd">        :const:`REQUIRED_VALUES` of the respective subclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">refvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refparameter</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">reqvalue</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">REQUIRED_VALUES</span><span class="p">:</span>
            <span class="n">mask</span><span class="p">[</span><span class="n">refvalues</span> <span class="o">==</span> <span class="n">reqvalue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="n">verifymask</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getverifymask</span><span class="p">)</span>

<div class="viewcode-block" id="ZipParameter.compressrepr"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.ZipParameter.compressrepr">[docs]</a>    <span class="k">def</span> <span class="nf">compressrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a compressed parameter value string, which is (in</span>
<span class="sd">        accordance with :attr:`NDIM`) contained in a nested list.  If the</span>
<span class="sd">        compression fails, a :class:`~exceptions.NotImplementedError` is</span>
<span class="sd">        raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultiParameter</span><span class="o">.</span><span class="n">compressrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">refvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refparameter</span><span class="o">.</span><span class="n">values</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">refvalues</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Parameter </span><span class="si">%s</span><span class="s1"> is not defined &#39;</span>
                                          <span class="s1">&#39;poperly, which circumvents finding &#39;</span>
                                          <span class="s1">&#39;a suitable compressed.&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODEL_CONSTANTS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">REQUIRED_VALUES</span><span class="p">:</span>
                    <span class="n">unique</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">refvalues</span> <span class="o">==</span> <span class="n">value</span><span class="p">])</span>
                    <span class="n">unique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverttimefactor</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span>
                                       <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                                          <span class="n">objecttools</span><span class="o">.</span><span class="n">repr_</span><span class="p">(</span><span class="n">unique</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">exc</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">result</span></div></div>


<div class="viewcode-block" id="SeasonalParameter"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SeasonalParameter">[docs]</a><span class="k">class</span> <span class="nc">SeasonalParameter</span><span class="p">(</span><span class="n">MultiParameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for the flexible handling of parameters with anual cycles.</span>

<span class="sd">    Let us prepare a 1-dimensional :class:`SeasonalParameter` instance:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import SeasonalParameter</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter = SeasonalParameter()</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter.NDIM = 1</span>

<span class="sd">    For the following examples, we assume a simulation step size of one day:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.timetools import Period</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter.simulationstep = Period(&#39;1d&#39;)</span>

<span class="sd">    To define its shape, the first entry of the assigned :class:`tuple`</span>
<span class="sd">    object is ignored:</span>

<span class="sd">    &gt;&gt;&gt; seasonalparameter.shape = (None,)</span>

<span class="sd">    Instead it is derived from the `simulationstep` defined above:</span>

<span class="sd">    &gt;&gt;&gt; seasonalparameter.shape</span>
<span class="sd">    (366,)</span>

<span class="sd">    The annual pattern of seasonal parameters is defined through pairs of</span>
<span class="sd">    :class:`~hydpy.core.timetools.TOY` objects and different values (e.g.</span>
<span class="sd">    of type :class:`float`).  One can define them all at once in the</span>
<span class="sd">    following manner:</span>

<span class="sd">    &gt;&gt;&gt; seasonalparameter(_1=2., _7_1=4., _3_1_0_0_0=5.)</span>

<span class="sd">    Note that, as :class:`str` objects, all keywords in the call above would</span>
<span class="sd">    be proper :class:`~hydpy.core.timetools.TOY` initialization arguments.</span>
<span class="sd">    If they are not properly written, the following exception is raised:</span>

<span class="sd">    &gt;&gt;&gt; SeasonalParameter()(_a=1.)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to define parameter `seasonalparameter` of element `?`, the following error occured: While trying to retrieve the month for TOY (time of year) object based on the string `_a`, the following error occured: For TOY (time of year) objects, all properties must be of type `int`, but the value `a` of type `str` given for property `month` cannot be converted to `int`.</span>

<span class="sd">    As the following string representation shows, are the pairs of each</span>
<span class="sd">    :class:`SeasonalParameter` instance automatically sorted:</span>

<span class="sd">    &gt;&gt;&gt; seasonalparameter</span>
<span class="sd">    seasonalparameter(toy_1_1_0_0_0=2.0,</span>
<span class="sd">                      toy_3_1_0_0_0=5.0,</span>
<span class="sd">                      toy_7_1_0_0_0=4.0)</span>

<span class="sd">    By default, `toy` is used as a prefix string.  Using this prefix string,</span>
<span class="sd">    one can change the toy-value pairs via attribute access:</span>

<span class="sd">    &gt;&gt;&gt; seasonalparameter.toy_1_1_0_0_0</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; del seasonalparameter.toy_1_1_0_0_0</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter.toy_2_1_0_0_0 = 2.</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter</span>
<span class="sd">    seasonalparameter(toy_2_1_0_0_0=2.0,</span>
<span class="sd">                      toy_3_1_0_0_0=5.0,</span>
<span class="sd">                      toy_7_1_0_0_0=4.0)</span>

<span class="sd">    On applying function :func:`len` on :class:`SeasonalParameter` objects,</span>
<span class="sd">    the number of toy-value pairs is returned:</span>

<span class="sd">    &gt;&gt;&gt; len(seasonalparameter)</span>
<span class="sd">    3</span>

<span class="sd">    New values are checked to be compatible predefined shape:</span>

<span class="sd">    &gt;&gt;&gt; seasonalparameter.toy_1_1_0_0_0 = [1., 2.]</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: While trying to add a new or change an existing toy-value pair for the seasonal parameter `seasonalparameter` of element `?`, the following error occured: float() argument must be a string or a number...</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter = SeasonalParameter()</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter.NDIM = 2</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter.shape = (None, 3)</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter.toy_1_1_0_0_0 = [1., 2.]</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to add a new or change an existing toy-value pair for the seasonal parameter `seasonalparameter` of element `?`, the following error occured: could not broadcast input array from shape (2) into shape (3)</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter.toy_1_1_0_0_0 = [1., 2., 3.]</span>
<span class="sd">    &gt;&gt;&gt; seasonalparameter</span>
<span class="sd">    seasonalparameter(toy_1_1_0_0_0=[1.0, 2.0, 3.0])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">MultiParameter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The prefered way to pass values to :class:`Parameter` instances</span>
<span class="sd">        within parameter control files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">MultiParameter</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">toystr</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(</span><span class="n">toystr</span><span class="p">)),</span> <span class="n">values</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                        <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                            <span class="s1">&#39;While trying to define parameter `</span><span class="si">%s</span><span class="s1">` of element &#39;</span>
                            <span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">`&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exc</span>

<div class="viewcode-block" id="SeasonalParameter.refresh"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SeasonalParameter.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the actual simulation values based on the toy-value pairs.</span>

<span class="sd">        Usually, one does not need to call refresh explicitly, as it is</span>
<span class="sd">        called by methods __call__, __setattr__ and __delattr__ automatically,</span>
<span class="sd">        when required.</span>

<span class="sd">        Instantiate a 1-dimensional :class:`SeasonalParameter` object:</span>

<span class="sd">        &gt;&gt;&gt; sp = SeasonalParameter()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.timetools import Period</span>
<span class="sd">        &gt;&gt;&gt; sp.simulationstep = Period(&#39;1d&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sp.NDIM = 1</span>
<span class="sd">        &gt;&gt;&gt; sp.shape = (None,)</span>

<span class="sd">        When a :class:`SeasonalParameter` object does not contain any</span>
<span class="sd">        toy-value pairs yet, the method :func:`SeasonalParameter.refresh`</span>
<span class="sd">        sets all actual simulation values to zero:</span>

<span class="sd">        &gt;&gt;&gt; sp.values = 1.</span>
<span class="sd">        &gt;&gt;&gt; sp.refresh()</span>
<span class="sd">        &gt;&gt;&gt; sp.values[0]</span>
<span class="sd">        0.0</span>

<span class="sd">        When there is only one toy-value pair, its values are taken for</span>
<span class="sd">        all actual simulation values:</span>

<span class="sd">        &gt;&gt;&gt; sp.toy_1 = 2. # calls refresh automatically</span>
<span class="sd">        &gt;&gt;&gt; sp.values[0]</span>
<span class="sd">        2.0</span>

<span class="sd">        Method :func:`SeasonalParameter.refresh` performs a linear</span>
<span class="sd">        interpolation for the central time points of each simulation time</span>
<span class="sd">        step.  Hence, in the following example the original values of the</span>
<span class="sd">        toy-value pairs do not show up:</span>

<span class="sd">        &gt;&gt;&gt; sp.toy_12_31 = 4.</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.objecttools import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.values[0])</span>
<span class="sd">        2.00274</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.values[-2])</span>
<span class="sd">        3.99726</span>
<span class="sd">        &gt;&gt;&gt; sp.values[-1]</span>
<span class="sd">        3.0</span>

<span class="sd">        If one wants to preserve the original values in this example, one</span>
<span class="sd">        would have to set the corresponding toy instances in the middle of</span>
<span class="sd">        some simulation step intervalls:</span>

<span class="sd">        &gt;&gt;&gt; del sp.toy_1</span>
<span class="sd">        &gt;&gt;&gt; del sp.toy_12_31</span>
<span class="sd">        &gt;&gt;&gt; sp.toy_1_1_12 = 2</span>
<span class="sd">        &gt;&gt;&gt; sp.toy_12_31_12 = 4.</span>
<span class="sd">        &gt;&gt;&gt; sp.values[0]</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.values[1])</span>
<span class="sd">        2.005479</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.values[-2])</span>
<span class="sd">        3.994521</span>
<span class="sd">        &gt;&gt;&gt; sp.values[-1]</span>
<span class="sd">        4.0</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applytimefactor</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="n">timetools</span>
            <span class="n">timegrid</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">Timegrid</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">TOY</span><span class="o">.</span><span class="n">_STARTDATE</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">simulationstep</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                                   <span class="n">tt</span><span class="o">.</span><span class="n">TOY</span><span class="o">.</span><span class="n">_ENDDATE</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">simulationstep</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">simulationstep</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">timegrid</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applytimefactor</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="SeasonalParameter.interp"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SeasonalParameter.interp">[docs]</a>    <span class="k">def</span> <span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform a linear value interpolation for a date defined by the</span>
<span class="sd">        passed :class:`~hydpy.core.timetools.Date` object and return the</span>
<span class="sd">        result.</span>

<span class="sd">        Instantiate a 1-dimensional :class:`SeasonalParameter` object:</span>

<span class="sd">        &gt;&gt;&gt; sp = SeasonalParameter()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.timetools import Date, Period</span>
<span class="sd">        &gt;&gt;&gt; sp.simulationstep = Period(&#39;1d&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sp.NDIM = 1</span>
<span class="sd">        &gt;&gt;&gt; sp.shape = (None,)</span>

<span class="sd">        Define three toy-value pairs:</span>
<span class="sd">        &gt;&gt;&gt; sp(_1=2.0, _2=5.0, _12_31=4.0)</span>

<span class="sd">        Passing a :class:`~hydpy.core.timetools.Date` object excatly matching</span>
<span class="sd">        a :class:`~hydpy.core.timetools.TOY` object of course simply returns</span>
<span class="sd">        the associated value:</span>

<span class="sd">        &gt;&gt;&gt; sp.interp(Date(&#39;2000.01.01&#39;))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; sp.interp(Date(&#39;2000.02.01&#39;))</span>
<span class="sd">        5.0</span>
<span class="sd">        &gt;&gt;&gt; sp.interp(Date(&#39;2000.12.31&#39;))</span>
<span class="sd">        4.0</span>

<span class="sd">        For all intermediate points, a linear interpolation is performed:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.objecttools import round_</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.interp(Date(&#39;2000.01.02&#39;)))</span>
<span class="sd">        2.096774</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.interp(Date(&#39;2000.01.31&#39;)))</span>
<span class="sd">        4.903226</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.interp(Date(&#39;2000.02.02&#39;)))</span>
<span class="sd">        4.997006</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.interp(Date(&#39;2000.12.30&#39;)))</span>
<span class="sd">        4.002994</span>

<span class="sd">        Linear interpolation is also allowed between the first and the</span>
<span class="sd">        last pair, when they do not capture the end points of the year:</span>

<span class="sd">        &gt;&gt;&gt; sp(_1_2=2.0, _12_30=4.0)</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.interp(Date(&#39;2000.12.29&#39;)))</span>
<span class="sd">        3.99449</span>
<span class="sd">        &gt;&gt;&gt; sp.interp(Date(&#39;2000.12.30&#39;))</span>
<span class="sd">        4.0</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.interp(Date(&#39;2000.12.31&#39;)))</span>
<span class="sd">        3.333333</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.interp(Date(&#39;2000.01.01&#39;)))</span>
<span class="sd">        2.666667</span>
<span class="sd">        &gt;&gt;&gt; sp.interp(Date(&#39;2000.01.02&#39;))</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; round_(sp.interp(Date(&#39;2000.01.03&#39;)))</span>
<span class="sd">        2.00551</span>

<span class="sd">        The following example briefly shows interpolation performed for</span>
<span class="sd">        2-dimensional parameter:</span>

<span class="sd">        &gt;&gt;&gt; sp = SeasonalParameter()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.timetools import Date, Period</span>
<span class="sd">        &gt;&gt;&gt; sp.simulationstep = Period(&#39;1d&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sp.NDIM = 2</span>
<span class="sd">        &gt;&gt;&gt; sp.shape = (None, 2)</span>
<span class="sd">        &gt;&gt;&gt; sp(_1_1=[1., 2.], _1_3=[-3, 0.])</span>
<span class="sd">        &gt;&gt;&gt; result = sp.interp(Date(&#39;2000.01.02&#39;))</span>
<span class="sd">        &gt;&gt;&gt; round_(result[0])</span>
<span class="sd">        -1.0</span>
<span class="sd">        &gt;&gt;&gt; round_(result[1])</span>
<span class="sd">        1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="n">xys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xys</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">xnew</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">xys</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">xys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">xys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">y0</span><span class="o">+</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">xnew</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">shape</span><span class="p">),)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulationstep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s1">&#39;It is not possible the set the shape of the seasonal &#39;</span>
                <span class="s1">&#39;parameter `</span><span class="si">%s</span><span class="s1">` of element `</span><span class="si">%s</span><span class="s1">` at the moment.  You can &#39;</span>
                <span class="s1">&#39;define it manually.  In complete HydPy projects it is &#39;</span>
                <span class="s1">&#39;indirecty defined via `pub.timegrids.stepsize` automatically.&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">timetools</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;366d&#39;</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">simulationstep</span>
        <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">)))</span>
        <span class="n">MultiParameter</span><span class="o">.</span><span class="n">_setshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">MultiParameter</span><span class="o">.</span><span class="n">_getshape</span><span class="p">,</span> <span class="n">_setshape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">toy</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">toy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span><span class="p">[</span><span class="n">toy</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;toy_&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                    <span class="s1">&#39;While trying to get an existing toy-value pair for &#39;</span>
                    <span class="s1">&#39;the seasonal parameter `</span><span class="si">%s</span><span class="s1">` of element `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">SeasonalParameter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;toy_&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                    <span class="s1">&#39;While trying to add a new or change an existing &#39;</span>
                    <span class="s1">&#39;toy-value pair for the seasonal parameter `</span><span class="si">%s</span><span class="s1">` of &#39;</span>
                    <span class="s1">&#39;element `</span><span class="si">%s</span><span class="s1">`&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MultiParameter</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;toy_&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span><span class="p">[</span><span class="n">timetools</span><span class="o">.</span><span class="n">TOY</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                    <span class="s1">&#39;While trying to delete an existing toy-value pair for &#39;</span>
                    <span class="s1">&#39;the seasonal parameter `</span><span class="si">%s</span><span class="s1">` of element `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MultiParameter</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">assign</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">assign</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">assign</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;()&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">blanks</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">toy</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">=&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">toy</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">=&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">blanks</span><span class="p">,</span> <span class="n">toy</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assign</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">79</span><span class="p">))</span>
            <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">return</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toy2values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">toy</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">toy</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>


<div class="viewcode-block" id="KeywordParameter2DType"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordParameter2DType">[docs]</a><span class="k">class</span> <span class="nc">KeywordParameter2DType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add the construction of `_ROWCOLMAPPING` to :class:`type`.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parents</span><span class="p">,</span> <span class="n">dict_</span><span class="p">):</span>
        <span class="n">rownames</span> <span class="o">=</span> <span class="n">dict_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ROWNAMES&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ROWNAMES&#39;</span><span class="p">,</span> <span class="p">()))</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="n">dict_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;COLNAMES&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;COLNAMES&#39;</span><span class="p">,</span> <span class="p">()))</span>
        <span class="n">rowcolmappings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">rowname</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rownames</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">jdx</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colnames</span><span class="p">):</span>
                <span class="n">rowcolmappings</span><span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">rowname</span><span class="p">,</span> <span class="n">colname</span><span class="p">))]</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span><span class="p">)</span>
        <span class="n">dict_</span><span class="p">[</span><span class="s1">&#39;_ROWCOLMAPPINGS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rowcolmappings</span>
        <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parents</span><span class="p">,</span> <span class="n">dict_</span><span class="p">)</span></div>


<span class="n">KeywordParameter2DMetaclass</span> <span class="o">=</span> <span class="n">KeywordParameter2DType</span><span class="p">(</span>
                          <span class="s1">&#39;KeywordParameter2DMetaclass&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">MultiParameter</span><span class="p">,),</span> <span class="p">{})</span>


<div class="viewcode-block" id="KeywordParameter2D"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordParameter2D">[docs]</a><span class="k">class</span> <span class="nc">KeywordParameter2D</span><span class="p">(</span><span class="n">KeywordParameter2DMetaclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for 2-dimensional model parameters which values which depend</span>
<span class="sd">    on two factors.</span>

<span class="sd">    When inheriting an actual parameter class from :class:`KeywordParameter2D`</span>
<span class="sd">    one needs to define the class attributes</span>
<span class="sd">    :const:`~KeywordParameter2D.ROWNAMES` and</span>
<span class="sd">    :const:`~KeywordParameter2D.COLNAMES` (both of type :class:`tuple`).</span>
<span class="sd">    One usual setting would be that :const:`~KeywordParameter2D.ROWNAMES`</span>
<span class="sd">    defines some land use classes and :const:`~KeywordParameter2D.COLNAMES`</span>
<span class="sd">    defines seasons, months, or the like.</span>

<span class="sd">    Consider the following example, where the boolean parameter `IsWarm` both</span>
<span class="sd">    depends on the half-year period and the hemisphere:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.parametertools import KeywordParameter2D</span>
<span class="sd">    &gt;&gt;&gt; class IsWarm(KeywordParameter2D):</span>
<span class="sd">    ...     TYPE = bool</span>
<span class="sd">    ...     ROWNAMES = (&#39;north&#39;, &#39;south&#39;)</span>
<span class="sd">    ...     COLNAMES = (&#39;apr2sep&#39;, &#39;oct2mar&#39;)</span>

<span class="sd">    Instantiate the defined parameter class and define its shape:</span>

<span class="sd">    &gt;&gt;&gt; iswarm = IsWarm()</span>
<span class="sd">    &gt;&gt;&gt; iswarm.shape = (2, 2)</span>

<span class="sd">    :class:`KeywordParameter2D` allows to set the values of all rows via</span>
<span class="sd">    keyword arguments:</span>

<span class="sd">    &gt;&gt;&gt; iswarm(north=[True, False],</span>
<span class="sd">    ...        south=[False, True])</span>
<span class="sd">    &gt;&gt;&gt; iswarm</span>
<span class="sd">    iswarm(north=[True, False],</span>
<span class="sd">           south=[False, True])</span>
<span class="sd">    &gt;&gt;&gt; iswarm.values</span>
<span class="sd">    array([[ True, False],</span>
<span class="sd">           [False,  True]], dtype=bool)</span>

<span class="sd">    If a keyword is missing, a :class:`~exceptions.TypeError` is raised:</span>

<span class="sd">    &gt;&gt;&gt; iswarm(north=[True, False])</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: When setting parameter `iswarm` of element `?` via row related keyword arguments, each string defined in `ROWNAMES` must be used as a keyword, but the following keyword is not: `south`.</span>

<span class="sd">    But one can modify single rows via attribute access:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.north = False, False</span>
<span class="sd">    &gt;&gt;&gt; iswarm.north</span>
<span class="sd">    array([False, False], dtype=bool)</span>

<span class="sd">    The same holds true for the columns:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.apr2sep = True, False</span>
<span class="sd">    &gt;&gt;&gt; iswarm.apr2sep</span>
<span class="sd">    array([ True, False], dtype=bool)</span>

<span class="sd">    Even a combined row-column access is supported in the following manner:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.north_apr2sep</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; iswarm.north_apr2sep = False</span>
<span class="sd">    &gt;&gt;&gt; iswarm.north_apr2sep</span>
<span class="sd">    False</span>

<span class="sd">    All three forms of attribute access define augmented exception messages</span>
<span class="sd">    in case anything goes wrong:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.north = True, True, True</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to assign new values to parameter `iswarm` of element `?` via the row related attribute `north`, the following error occured: cannot copy sequence with size 3 to array axis with dimension 2</span>
<span class="sd">    &gt;&gt;&gt; iswarm.apr2sep = True, True, True</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to assign new values to parameter `iswarm` of element `?` via the column related attribute `apr2sep`, the following error occured: cannot copy sequence with size 3 to array axis with dimension 2</span>

<span class="sd">    &gt;&gt;&gt; iswarm.shape = (1, 1)</span>
<span class="sd">    &gt;&gt;&gt; iswarm.south_apr2sep = False</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    IndexError: While trying to assign new values to parameter `iswarm` of element `?` via the row and column related attribute `south_apr2sep`, the following error occured: index 1 is out of bounds for axis 0 with size 1</span>
<span class="sd">    &gt;&gt;&gt; iswarm.shape = (2, 2)</span>

<span class="sd">    Of course, one can define the parameter values in the common manner, e.g.:</span>

<span class="sd">    &gt;&gt;&gt; iswarm(True)</span>
<span class="sd">    &gt;&gt;&gt; iswarm</span>
<span class="sd">    iswarm(north=[True, True],</span>
<span class="sd">           south=[True, True])</span>

<span class="sd">    For parameters with many columns, string representations are properly</span>
<span class="sd">    wrapped:</span>

<span class="sd">    &gt;&gt;&gt; iswarm.shape = (2, 10)</span>
<span class="sd">    &gt;&gt;&gt; iswarm</span>
<span class="sd">    iswarm(north=[False, False, False, False, False, False, False, False,</span>
<span class="sd">                  False, False],</span>
<span class="sd">           south=[False, False, False, False, False, False, False, False,</span>
<span class="sd">                  False, False])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ROWNAMES</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">COLNAMES</span> <span class="o">=</span> <span class="p">()</span>

<div class="viewcode-block" id="KeywordParameter2D.connect"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.KeywordParameter2D.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subpars</span><span class="p">):</span>
        <span class="n">MultiParameter</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subpars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROWNAMES</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COLNAMES</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">MultiParameter</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROWNAMES</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">miss</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROWNAMES</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;When setting parameter `</span><span class="si">%s</span><span class="s1">` of element `</span><span class="si">%s</span><span class="s1">` via &#39;</span>
                        <span class="s1">&#39;row related keyword arguments, each string &#39;</span>
                        <span class="s1">&#39;defined in `ROWNAMES` must be used as a keyword, &#39;</span>
                        <span class="s1">&#39;but the following keyword</span><span class="si">%s</span><span class="s1"> not: `</span><span class="si">%s</span><span class="s1">`.&#39;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="s1">&#39; is&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">miss</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;s are&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">miss</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commentrepr</span><span class="p">()</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROWNAMES</span><span class="p">):</span>
            <span class="n">subprefix</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">=&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span>
                         <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">=&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">blanks</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:],</span>
                                                     <span class="n">subprefix</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROWNAMES</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ROWNAMES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="p">:]</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                    <span class="s1">&#39;While trying to retrieve values from parameter `</span><span class="si">%s</span><span class="s1">` of &#39;</span>
                    <span class="s1">&#39;element `</span><span class="si">%s</span><span class="s1">` via the row related attribute `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">COLNAMES</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">COLNAMES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                    <span class="s1">&#39;While trying to retrieve values from parameter `</span><span class="si">%s</span><span class="s1">` of &#39;</span>
                    <span class="s1">&#39;element `</span><span class="si">%s</span><span class="s1">` via the columnd related attribute `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ROWCOLMAPPINGS</span><span class="p">:</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ROWCOLMAPPINGS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                    <span class="s1">&#39;While trying to retrieve values from parameter `</span><span class="si">%s</span><span class="s1">` of &#39;</span>
                    <span class="s1">&#39;element `</span><span class="si">%s</span><span class="s1">` via the row and column related attribute &#39;</span>
                    <span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">`&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultiParameter</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROWNAMES</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ROWNAMES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                    <span class="s1">&#39;While trying to assign new values to parameter `</span><span class="si">%s</span><span class="s1">` of &#39;</span>
                    <span class="s1">&#39;element `</span><span class="si">%s</span><span class="s1">` via the row related attribute `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">COLNAMES</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">COLNAMES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                    <span class="s1">&#39;While trying to assign new values to parameter `</span><span class="si">%s</span><span class="s1">` of &#39;</span>
                    <span class="s1">&#39;element `</span><span class="si">%s</span><span class="s1">` via the column related attribute `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ROWCOLMAPPINGS</span><span class="p">:</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ROWCOLMAPPINGS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augmentexcmessage</span><span class="p">(</span>
                    <span class="s1">&#39;While trying to assign new values to parameter `</span><span class="si">%s</span><span class="s1">` of &#39;</span>
                    <span class="s1">&#39;element `</span><span class="si">%s</span><span class="s1">` via the row and column related attribute &#39;</span>
                    <span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">`&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MultiParameter</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROWNAMES</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COLNAMES</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ROWCOLMAPPINGS</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>


<div class="viewcode-block" id="LeftRightParameter"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.LeftRightParameter">[docs]</a><span class="k">class</span> <span class="nc">LeftRightParameter</span><span class="p">(</span><span class="n">MultiParameter</span><span class="p">):</span>
    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">MultiParameter</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;When setting the values of parameter `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                                 <span class="s1">&#39;of element `</span><span class="si">%s</span><span class="s1">` via keyword arguments, &#39;</span>
                                 <span class="s1">&#39;either `left` or `l` for the &quot;left&quot; &#39;</span>
                                 <span class="s1">&#39;parameter value must be given, but is not.&#39;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;When setting the values of parameter `</span><span class="si">%s</span><span class="s1">`&#39;</span>
                                 <span class="s1">&#39;of element `</span><span class="si">%s</span><span class="s1">` via keyword arguments, &#39;</span>
                                 <span class="s1">&#39;either `right` or `r` for the &quot;right&quot; &#39;</span>
                                 <span class="s1">&#39;parameter value must be given, but is not.&#39;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>

<div class="viewcode-block" id="LeftRightParameter.connect"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.LeftRightParameter.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subpars</span><span class="p">):</span>
        <span class="n">MultiParameter</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subpars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="mi">2</span></div>

    <span class="k">def</span> <span class="nf">_getleft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The &quot;left&quot; value of the actual parameter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_setleft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">left</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getleft</span><span class="p">,</span> <span class="n">_setleft</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">left</span>

    <span class="k">def</span> <span class="nf">_getright</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The &quot;right&quot; value of the actual parameter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_setright</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">right</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getright</span><span class="p">,</span> <span class="n">_setright</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">right</span></div>


<div class="viewcode-block" id="IndexParameter"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.IndexParameter">[docs]</a><span class="k">class</span> <span class="nc">IndexParameter</span><span class="p">(</span><span class="n">MultiParameter</span><span class="p">):</span>

<div class="viewcode-block" id="IndexParameter.setreference"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.IndexParameter.setreference">[docs]</a>    <span class="k">def</span> <span class="nf">setreference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexarray</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">indexarray</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SolverParameter"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SolverParameter">[docs]</a><span class="k">class</span> <span class="nc">SolverParameter</span><span class="p">(</span><span class="n">SingleParameter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SolverParameter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SolverParameter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alternative_initvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="SolverParameter.update"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SolverParameter.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alternative_initvalue</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modify_init</span><span class="p">())</span></div>

<div class="viewcode-block" id="SolverParameter.modify_init"><a class="viewcode-back" href="../../../parametertools.html#hydpy.core.parametertools.SolverParameter.modify_init">[docs]</a>    <span class="k">def</span> <span class="nf">modify_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">INIT</span></div>

    <span class="k">def</span> <span class="nf">_get_alternative_initvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s1">&#39;No alternative initial value for solver parameter `</span><span class="si">%s</span><span class="s1">` of &#39;</span>
                <span class="s1">&#39;element `</span><span class="si">%s</span><span class="s1">` has been defined so far.&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span>

    <span class="k">def</span> <span class="nf">_set_alternative_initvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_del_alternative_initvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternative_initvalue</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">alternative_initvalue</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_alternative_initvalue</span><span class="p">,</span>
                                     <span class="n">_set_alternative_initvalue</span><span class="p">,</span>
                                     <span class="n">_del_alternative_initvalue</span><span class="p">)</span></div>


<span class="n">autodoctools</span><span class="o">.</span><span class="n">autodoc_module</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Christoph Tyralla.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.5.
    </div>
  </body>
</html>